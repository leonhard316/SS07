# SS07 プライバシーカメラの開発

###  

### 開発環境

- Visual C ++ 2019

- OpenCV 4.5.0

- cvui(ver 2020/4/8) 

- MyOpenCV(ヘッダー)


### 動作仕様

#### カメラに映る人物の顔を自動的に検出し，顔部分をぼかして(デフォルトはガウシアン)表示する.

- ss07.cppコード1行目で#define pipelineをコメントアウトするかしないかで，逐次処理とパイプライン処理を切り替える．

- ImageNet Caffeリファレンスモデルを以下のディレクトリに保存
> "D:/ss/ss07/ss07/ss07/dnn(caffe)/deploy.prototxt"
> "D:/ss/ss07/ss07/ss07/dnn(caffe)/res10_300x300_ssd_iter_140000_fp16.caffemodel";

- デバッグで動画読み込み，リリースでカメラ入力

### 使用方法

- デバッグ:動画読み込み, リリース:カメラ入力

 #### キーボード操作
 

 >> 動画保存と終了 : Q　

 >> ぼかし :　F1：普通のブラー　F2：ガウシアンブラー(上下キーでガウシアンの強度を変更)　F3：メディアンブラー　F4：ブラーなし

 >> 顔検出の枠 :　Delete：枠を消す　Insert：枠をつける

 >> 時間・フレーム表示 :　Backspace：時間・フレーム表示を消す

 >> 右クリックしている間 :  help(キーボード操作)を表示

- [動画説明](https://youtu.be/YzPC1Ok9qy8)


### 未実装課題

- ぼかし領域サイズの増減

- 顔検出モデルの考察

- ぼかしの境界を滑らかに処理する(顔マスクを作成して，そこのみブラーをかけることを予定していた)

- 出力動画ファイル名のデフォルト名

- 指定した顔のぼかしを解除

### 計測時間


  #### 逐次処理(Debug)

  >> カメラ入力 0.018s

  >> 顔検出 0.045s

  >> ぼかし 0.159s

  >> 画面表示 0.002s

  >> File保存 0.001s

  #### パイプライン処理(Debug)

  >> カメラ入力 0.019s

  >> 顔検出 0.212s

  >> ぼかし 0.213s

  >> 画面表示 0.217s
 
  >> File保存 0.217s

### 考察
- 今回デバッグモードで同じ動画を読み込むことで，条件を揃え時間を計測した．

- フレームごとに検出する人物が違うため,ぼかしや人物検出といった作業はフレームごとに大きく値が異なる．

- 単純に比較することはできない．

- フレームで検出される人物が増えるほど，同時にスレッドが処理していることが確認できたので，パイプライン処理はフレームに映る人が多いほど，
効果を発揮する傾向にありそうである．

- 顔検出とぼかし処理がパイプライン処理で同じくらいの速度になるのは，一斉にフレーム上で検出した顔を配列にまとめて，共有して処理を行っているためだと考える.

- 逐次処理では，一個の顔を検出した後にぼかしをかけるようにしていたため，逐次処理とパイプライン処理の時間が大きく異なると考えられる．

- 画面表示とファイル保存はイベントで同期されるタイミングが同じであり，処理内容もそこまで複雑ではないため，逐次，パイプライン間でそれぞれ同じような値になったと考えられる．
